<!DOCTYPE html>
<html lang="en" style="font-size: 80px;">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <script src="./static/flexible.js"></script>
    <link rel="stylesheet" href="./static/index2.css" />
    <title>数字心脏监测系统</title>
    <link rel="stylesheet" href="static/index2.css" />
</head>
<body style="font-size: 12px;">
<!-- 头部模块 -->
<div class="header">
    <span class="title">数字心脏监测系统</span>
    <span class="time" id="show_time">2025-08-02 15:50:50</span>
    <span class="desc">北京大学健康医疗大数据国家研究院：<a href="https://gitee.com/iGaoWei/big-data-view">Website</a></span>
</div>
<!-- 主题模块 -->
<div class="main">
    <div class="left_main">
        <div class="slide_wrap" style="display: flex; flex-direction: column; height: 100%; padding: 0;">

            <div id="left_chat_header" style="padding: 15px; display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid rgba(255, 255, 255, 0.1);">
                <span style="color: white; font-weight: bold; font-size: 16px;">新的聊天</span>
                <div>
                    <span style="color: #ccc; margin-left: 15px; cursor: pointer; font-size: 18px;">↻</span>
                    <span style="color: #ccc; margin-left: 15px; cursor: pointer; font-size: 18px;">✎</span>
                </div>
            </div>

            <div id="chat_message_area" style="flex-grow: 1; overflow-y: auto; padding: 20px;">
                <div class="message-group" style="display: flex; align-items: flex-start; margin-bottom: 20px;">
                    <img src="./static/title.png" alt="avatar" style="width: 36px; height: 36px; border-radius: 50%; margin-right: 12px; flex-shrink: 0;">
                    <div class="message-content" style="display: flex; flex-direction: column; align-items: flex-start;">
                        <span class="sender-name" style="color: #eee; font-size: 14px; margin-bottom: 5px;">HeartTalk</span>
                        <div class="message-bubble" style="background-color: rgba(30, 60, 130, 0.5); color: #fff; padding: 10px 15px; border-radius: 8px; border-top-left-radius: 0; max-width: 100%;">
                            您好，我是HeartTalk。
                        </div>
                    </div>
                </div>
            </div>

            <div id="chat_input_section" style="padding: 15px; border-top: 1px solid rgba(255, 255, 255, 0.1);">
                <div class="input-toolbar" style="margin-bottom: 10px;">
                    <span style="color: #ccc; margin-right: 15px; cursor: pointer; font-size: 18px;">◎</span>
                    <span style="color: #ccc; margin-right: 15px; cursor: pointer; font-size: 18px;">❐</span>
                </div>
                <div class="main-input-area" style="display: flex; align-items: flex-end;">
                    <textarea id="chat_textarea_input" placeholder="Enter 发送, Shift + Enter 换行, / 触发补全, # 触发命令" style="flex-grow: 1; background-color: transparent; border: none; color: white; resize: none; height: 24px; line-height: 24px; font-size: 14px; max-height: 100px; outline: none;"></textarea>
                    <button id="chat_send_button" style="background-color: #0B4EC3; color: white; border: none; border-radius: 4px; padding: 8px 18px; cursor: pointer; margin-left: 10px; flex-shrink: 0;">发送</button>
                </div>
            </div>

        </div>
        <div class="panel-footer"></div>
    </div>
    <div class="center_main">
        <div class="center_top" style="width: 684px; height: 430px; position: relative; background-color: #0b1c2c; overflow: hidden;">
            
            <div id="video-container-1" style="width: 100%; height: 100%;">
                <video id="heart-video-1" width="100%" height="100%" muted autoplay style="object-fit: cover;">
                    <source src="./static/media/heart_video.mp4" type="video/mp4">
                </video>
            </div>

            <div id="video-container-2" style="width: 100%; height: 100%; display: none; position: absolute; top: 0; left: 0;">
                <video id="heart-video-2" width="100%" height="100%" muted loop autoplay style="object-fit: cover;">
                    <source src="./static/media/heart_video_loop.mp4" type="video/mp4">
                </video>
            </div>

        </div>
        <div class="center_bottom">
            <div class="center_bottom_box" style="width: 684px; height: 210px; display: flex; flex-direction: column;">
                
                <div class="right_title">
                    <img src="./static/title.png" alt="" />实时心电分析报告
                    </div>
                
                <div class="report-content" style="padding: 15px 20px; color: #cceeff; font-size: 16px; line-height: 1.9; overflow-y: auto; flex-grow: 1;">
                    <p>
                        <strong>患者ID 00A-7231</strong> 的心脏健康评估报告 (生成时间: 2025-08-01 22:02:51)。初步分析显示，当前心电活动稳定，整体状况在正常范围内，心电波形形态规整。
                    </p>
                    <p>
                        详细生理指标如下：平均心率 (Heart Rate) 为 <strong>68 bpm</strong>，处于静息状态下的理想区间。PR间期为 <strong>150 ms</strong>，QRS波群宽度为 <strong>90 ms</strong>，QTc间期为 <strong>425 ms</strong>，以上指标均在标准参考值内。ST段未见有临床意义的偏移或异常波动。
                    </p>
                    <p>
                        <strong>诊断结论：窦性心律 (Sinus Rhythm)</strong>。当前无明显心律失常指征，心脏事件风险等级评估为 <strong>低风险</strong>。建议继续保持常规监测。
                    </p>
                    </div>
                    
            </div>
        </div>
    </div>
    <div class="right_main">
        <div class="right_box">
            <div class="right_title">
                <img src="./static/title.png" alt="">实时心电波形图 (ECG)
            </div>
            <div id="ecg_line_chart" style="width: 100%; height: 220px;"></div>
        </div>
        <div class="right_box">
            <div class="right_title">
                <img src="./static/title.png" alt="">核心心电指标
            </div>
            <div class="gauge-grid-container">
                <div class="gauge-item">
                    <div id="gauge_1" style="width: 100%; height: 120px;"></div>
                    <div class="gauge-title">心率 (bpm)</div>
                </div>
                <div class="gauge-item">
                    <div id="gauge_2" style="width: 100%; height: 120px;"></div>
                    <div class="gauge-title">PR 间期 (ms)</div>
                </div>
                <div class="gauge-item">
                    <div id="gauge_3" style="width: 100%; height: 120px;"></div>
                    <div class="gauge-title">QRS 波群 (ms)</div>
                </div>
                <div class="gauge-item">
                    <div id="gauge_4" style="width: 100%; height: 120px;"></div>
                    <div class="gauge-title">QT 间期 (ms)</div>
                </div>
                <div class="gauge-item">
                    <div id="gauge_5" style="width: 100%; height: 120px;"></div>
                    <div class="gauge-title">P 电轴 (°)</div>
                </div>
                <div class="gauge-item">
                    <div id="gauge_6" style="width: 100%; height: 120px;"></div>
                    <div class="gauge-title">T 电轴 (°)</div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="./static/echarts.min.js"></script>
<script src="./static/index2.js"></script>
<script>
    // --- 视频切换逻辑 ---
    // 1. 获取所有相关的视频容器和视频元素
    const videoContainer1 = document.getElementById('video-container-1');
    const video1 = document.getElementById('heart-video-1');
    const videoContainer2 = document.getElementById('video-container-2');
    const video2 = document.getElementById('heart-video-2');

    // 2. 确保所有元素都已找到，避免出错
    if (video1 && videoContainer1 && video2 && videoContainer2) {
        
        // 3. 为第一个视频添加 'ended' (播放结束) 事件监听器
        video1.addEventListener('ended', () => {
            // 隐藏第一个视频的容器
            videoContainer1.style.display = 'none';
            // 显示第二个视频的容器
            videoContainer2.style.display = 'block';
            
            // 确保第二个视频开始播放 (虽然有autoplay，但这样做更保险)
            video2.play();
        });
    }

</script>
<script>
    // --- 右上角：初始化实时心电图 (ECG Line Chart) ---

// 1. 基于准备好的dom，初始化echarts实例
const ecgChart = echarts.init(document.getElementById('ecg_line_chart'));

// 2. 数据和配置
let ecgData = []; // 图表数据
let date = []; // X轴时间标签
let base = +new Date(); // 起始时间戳

// 生成一段模拟的、看起来像心电图的基准波形数据
const sampleEcgWave = [0, 0, 0.05, 0.2, 0.8, -0.1, -0.05, 0.02, 0, 0, 0, 1.2, -0.4, 0, 0.1, 0.25, 0.3, 0.2, 0.1, 0, 0, 0, 0, 0, 0, 0, 0, 0];
let dataIndex = 0; // 当前波形数据的索引

// 3. 定义一个函数，用于向图表添加新数据
function addData(shift) {
    let now = new Date(base += 50); // 每次前进50毫秒
    date.push([now.getHours(), now.getMinutes(), now.getSeconds()].join(':'));
    
    // 循环使用样本波形数据，制造连续心跳的效果
    ecgData.push(sampleEcgWave[dataIndex]);
    dataIndex = (dataIndex + 1) % sampleEcgWave.length;

    // 如果shift为true，则删除数组的第一个元素，实现窗口滚动的效果
    if (shift) {
        date.shift();
        ecgData.shift();
    }
}

// 4. 初始填充一些数据，让图表第一次显示时不是空的
for (let i = 0; i < 100; i++) {
    addData();
}

// 5. 指定图表的配置项和数据
const ecgOption = {
    grid: { left: '3%', right: '4%', bottom: '3%', containLabel: true }, // 调整图表边距
    tooltip: { trigger: 'axis' },
    xAxis: { 
        show: false, // 不显示X轴
        type: 'category', 
        boundaryGap: false, 
        data: date 
    },
    yAxis: { 
        type: 'value', 
        min: -0.5, // Y轴最小值
        max: 1.5,  // Y轴最大值
        splitLine: { lineStyle: { color: 'rgba(255,255,255,0.1)' } } // 坐标轴分割线颜色
    },
    series: [{
        name: 'ECG',
        type: 'line',
        smooth: true,      // 平滑曲线
        showSymbol: false, // 不显示数据点
        data: ecgData,
        lineStyle: { color: '#00ffc5', width: 2 }, // 线条样式
        areaStyle: { // 填充区域样式
            color: new echarts.graphic.LinearGradient(0, 0, 0, 1, [{
                offset: 0, color: 'rgba(0, 255, 197, 0.5)'
            }, {
                offset: 1, color: 'rgba(0, 255, 197, 0)'
            }])
        }
    }]
};

// 6. 使用刚指定的配置项和数据显示图表
ecgChart.setOption(ecgOption);

// 7. 设置定时器，每200毫秒更新一次图表，模拟实时数据流入
setInterval(function () {
    addData(true); // 传入true，实现滚动效果
    ecgChart.setOption({
        xAxis: { data: date },
        series: [{ data: ecgData }]
    });
}, 200);

// --- 右下角：初始化6个心电特征仪表盘 ---

// 1. 定义一个可复用的函数来生成仪表盘配置
function getGaugeOption(value, title, unit, min, max, lowThreshold, highThreshold) {
        const range = max - min;
        // 计算颜色分段的百分比位置
        const lowPercent = (lowThreshold - min) / range;
        const highPercent = (highThreshold - min) / range;

        return {
            series: [{
                type: 'gauge',
                min: min,
                max: max,
                splitNumber: 5, // 刻度线数量
                // 核心：定义三色轴线
                axisLine: {
                    lineStyle: {
                        width: 15, // 轴线宽度
                        color: [ // 根据阈值设置颜色区间
                            [lowPercent, '#F5B041'],   // 黄色 (低)
                            [highPercent, '#58D68D'], // 绿色 (正常)
                            [1, '#E74C3C']             // 红色 (高)
                        ]
                    }
                },
                // 显示指针
                pointer: {
                    icon: 'path://M12.8,0.7l12,40.1H0.7L12.8,0.7z',
                    length: '60%',
                    width: 6,
                    offsetCenter: [0, '-50%'],
                    itemStyle: {
                        color: 'auto' // 指针颜色会根据所在区间自动变化
                    }
                },
                axisTick: { distance: -15, length: 10, lineStyle: { color: '#fff', width: 1 } }, // 刻度样式
                splitLine: { distance: -15, length: 15, lineStyle: { color: '#fff', width: 2 } }, // 分隔线样式
                axisLabel: { color: 'auto', distance: 25, fontSize: 10 }, // 刻度标签
                title: { show: false },
                detail: { // 数值显示
                    valueAnimation: true,
                    fontSize: 20,
                    color: 'auto', // 数值颜色也自动变化
                    offsetCenter: [0, '70%'],
                    formatter: '{value}'
                },
                data: [{ value: value }]
            }]
        };
    }

    // 2. 初始化6个ECharts实例
    const gauge1 = echarts.init(document.getElementById('gauge_1'));
    const gauge2 = echarts.init(document.getElementById('gauge_2'));
    const gauge3 = echarts.init(document.getElementById('gauge_3'));
    const gauge4 = echarts.init(document.getElementById('gauge_4'));
    const gauge5 = echarts.init(document.getElementById('gauge_5'));
    const gauge6 = echarts.init(document.getElementById('gauge_6'));

    // 3. 为每个仪表盘设置新的配置，并传入正常范围的阈值
    // 参数格式: (当前值, 标题, 单位, 最小值, 最大值, 正常范围下限, 正常范围上限)
    gauge1.setOption(getGaugeOption(68, '心率', 'bpm', 40, 160, 60, 100));
    gauge2.setOption(getGaugeOption(150, 'PR间期', 'ms', 100, 220, 120, 200));
    gauge3.setOption(getGaugeOption(90, 'QRS波群', 'ms', 60, 140, 70, 110));
    gauge4.setOption(getGaugeOption(425, 'QT间期', 'ms', 300, 500, 340, 440));
    gauge5.setOption(getGaugeOption(45, 'P电轴', '°', -30, 100, 0, 75));
    gauge6.setOption(getGaugeOption(60, 'T电轴', '°', 0, 90, 15, 75));


</script>
</body>
</html>